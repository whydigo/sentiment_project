<!doctype html>
<html lang="ru">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>–ó–∞–≥—Ä—É–∑–∫–∞ Excel –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</title>
        <link
            rel="stylesheet"
            href="{{ url_for('static', filename='style.css') }}"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
        />
        <style>
            .upload-container {
                max-width: 800px;
                margin: 0 auto;
                padding: 30px;
                background: white;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            }

            .upload-area {
                border: 3px dashed #667eea;
                border-radius: 15px;
                padding: 50px;
                text-align: center;
                background: #f8f9fa;
                cursor: pointer;
                transition: all 0.3s;
                margin: 20px 0;
            }

            .upload-area:hover {
                background: #e8f0fe;
                border-color: #764ba2;
            }

            .upload-area i {
                font-size: 4em;
                color: #667eea;
                margin-bottom: 20px;
            }

            .upload-area h3 {
                color: #333;
                margin-bottom: 10px;
            }

            .upload-area p {
                color: #666;
                margin-bottom: 20px;
            }

            .file-info {
                background: #e8f0fe;
                padding: 15px;
                border-radius: 8px;
                margin: 20px 0;
                display: none;
            }

            .column-selector {
                background: #f8f9fa;
                padding: 20px;
                border-radius: 8px;
                margin: 20px 0;
                border: 1px solid #e0e0e0;
            }

            .preview-table {
                max-height: 300px;
                overflow-y: auto;
                border: 1px solid #e0e0e0;
                border-radius: 8px;
                margin: 20px 0;
            }

            .preview-table table {
                width: 100%;
                border-collapse: collapse;
            }

            .preview-table th {
                background: #667eea;
                color: white;
                padding: 10px;
                position: sticky;
                top: 0;
                z-index: 10;
            }

            .preview-table td {
                padding: 8px;
                border-bottom: 1px solid #e0e0e0;
            }

            .preview-table tr:hover {
                background: #f0f0f0;
            }

            .progress-container {
                margin: 30px 0;
                display: none;
            }

            .progress-bar {
                width: 100%;
                height: 30px;
                background: #e0e0e0;
                border-radius: 15px;
                overflow: hidden;
                margin: 10px 0;
            }

            .progress-fill {
                height: 100%;
                background: linear-gradient(90deg, #667eea, #764ba2);
                transition: width 0.3s ease;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 0.9em;
            }

            .job-status {
                margin: 20px 0;
                padding: 15px;
                border-radius: 8px;
                display: none;
            }

            .status-processing {
                background: #fff3cd;
                color: #856404;
                border: 1px solid #ffeeba;
            }

            .status-completed {
                background: #d4edda;
                color: #155724;
                border: 1px solid #c3e6cb;
            }

            .status-error {
                background: #f8d7da;
                color: #721c24;
                border: 1px solid #f5c6cb;
            }

            .download-btn {
                display: inline-block;
                padding: 15px 30px;
                background: linear-gradient(135deg, #4caf50, #45a049);
                color: white;
                text-decoration: none;
                border-radius: 8px;
                font-weight: bold;
                margin: 20px 0;
                transition: transform 0.3s;
            }

            .download-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
            }

            .options-panel {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
                margin: 20px 0;
            }

            .option-item {
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .batch-actions {
                display: flex;
                gap: 15px;
                justify-content: center;
                margin-top: 30px;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <header>
                <h1><i class="fas fa-file-excel"></i> –ü–∞–∫–µ—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ Excel</h1>
                <p class="subtitle">
                    –ó–∞–≥—Ä—É–∑–∏—Ç–µ Excel —Ñ–∞–π–ª —Å —Ç–µ–∫—Å—Ç–∞–º–∏ –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
                </p>
                <div class="model-info">
                    <i class="fas fa-info-circle"></i>
                    –ü—Ä–æ–≥—Ä–∞–º–º–∞ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ —Ç–µ–∫—Å—Ç—ã –∏ –¥–æ–±–∞–≤–∏—Ç –∫–æ–ª–æ–Ω–∫–∏ —Å
                    —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é –∏ —Ç–µ–º–∞—Ç–∏–∫–æ–π
                </div>
            </header>

            <div class="main-content">
                <div class="upload-container">
                    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ -->
                    <div
                        class="upload-area"
                        id="uploadArea"
                        onclick="document.getElementById('fileInput').click()"
                    >
                        <i class="fas fa-cloud-upload-alt"></i>
                        <h3>–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ Excel —Ñ–∞–π–ª–∞</h3>
                        <p>–∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞</p>
                        <input
                            type="file"
                            id="fileInput"
                            accept=".xlsx,.xls,.csv"
                            style="display: none"
                        />
                    </div>

                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ -->
                    <div class="file-info" id="fileInfo">
                        <h4>
                            <i
                                class="fas fa-check-circle"
                                style="color: #4caf50"
                            ></i>
                            –§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω:
                        </h4>
                        <p id="fileName"></p>
                        <p id="fileDetails"></p>
                    </div>

                    <!-- –°–µ–ª–µ–∫—Ç–æ—Ä –∫–æ–ª–æ–Ω–∫–∏ -->
                    <div
                        class="column-selector"
                        id="columnSelector"
                        style="display: none"
                    >
                        <h4>
                            <i class="fas fa-columns"></i> –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–æ–Ω–∫—É —Å
                            —Ç–µ–∫—Å—Ç–∞–º–∏:
                        </h4>
                        <select
                            id="columnSelect"
                            class="form-control"
                            style="width: 100%; padding: 10px; margin: 10px 0"
                        >
                            <option value="">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–ª–æ–Ω–æ–∫...</option>
                        </select>

                        <div class="options-panel">
                            <div class="option-item">
                                <input
                                    type="checkbox"
                                    id="includeConfidence"
                                    checked
                                />
                                <label>–î–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫–∏ —Å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é</label>
                            </div>
                            <div class="option-item">
                                <input
                                    type="checkbox"
                                    id="includeAltTopics"
                                    checked
                                />
                                <label>–î–æ–±–∞–≤–∏—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ç–µ–º—ã</label>
                            </div>
                            <div class="option-item">
                                <input type="checkbox" id="addEmoji" checked />
                                <label>–î–æ–±–∞–≤–∏—Ç—å —ç–º–æ–¥–∑–∏</label>
                            </div>
                        </div>

                        <!-- –ü–æ—Å–ª–µ options-panel -->
                        <div
                            class="rows-selector"
                            style="
                                margin: 20px 0;
                                padding: 15px;
                                background: #f0f4ff;
                                border-radius: 8px;
                                border-left: 4px solid #667eea;
                            "
                        >
                            <h4>
                                <i class="fas fa-list-ol"></i> –í—ã–±–æ—Ä –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
                                —Å—Ç—Ä–æ–∫:
                            </h4>
                            <div
                                style="
                                    display: flex;
                                    align-items: center;
                                    gap: 15px;
                                    flex-wrap: wrap;
                                "
                            >
                                <div style="flex: 1">
                                    <label
                                        for="rowCount"
                                        style="
                                            display: block;
                                            margin-bottom: 5px;
                                            color: #333;
                                        "
                                    >
                                        <i class="fas fa-calculator"></i>
                                        –°–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å:
                                    </label>
                                    <select
                                        id="rowCount"
                                        style="
                                            width: 100%;
                                            padding: 10px;
                                            border: 2px solid #667eea;
                                            border-radius: 5px;
                                        "
                                    >
                                        <option value="0">
                                            üìä –í—Å–µ —Å—Ç—Ä–æ–∫–∏ (–ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑)
                                        </option>
                                        <option value="10">
                                            üîü –ü–µ—Ä–≤—ã–µ 10 —Å—Ç—Ä–æ–∫
                                        </option>
                                        <option value="50">
                                            üî¢ –ü–µ—Ä–≤—ã–µ 50 —Å—Ç—Ä–æ–∫
                                        </option>
                                        <option value="100">
                                            üíØ –ü–µ—Ä–≤—ã–µ 100 —Å—Ç—Ä–æ–∫
                                        </option>
                                        <option value="custom">
                                            ‚úèÔ∏è –°–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                                        </option>
                                    </select>
                                </div>
                                <div
                                    id="customRowInput"
                                    style="display: none; flex: 1"
                                >
                                    <label
                                        style="
                                            display: block;
                                            margin-bottom: 5px;
                                            color: #333;
                                        "
                                    >
                                        <i class="fas fa-pencil-alt"></i>
                                        –í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:
                                    </label>
                                    <input
                                        type="number"
                                        id="customRowCount"
                                        min="1"
                                        max="10000"
                                        value="100"
                                        style="
                                            width: 100%;
                                            padding: 10px;
                                            border: 2px solid #667eea;
                                            border-radius: 5px;
                                        "
                                    />
                                </div>
                            </div>
                            <p
                                style="
                                    margin-top: 10px;
                                    font-size: 0.9em;
                                    color: #666;
                                "
                            >
                                <i class="fas fa-info-circle"></i>
                                <span id="totalRowsInfo"
                                    >–í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫ –≤ —Ñ–∞–π–ª–µ: –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª</span
                                >
                            </p>
                        </div>

                        <button
                            class="btn analyze-btn"
                            onclick="startAnalysis()"
                            style="width: 100%"
                        >
                            <i class="fas fa-play"></i> –ù–∞—á–∞—Ç—å –∞–Ω–∞–ª–∏–∑
                        </button>
                    </div>

                    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å -->
                    <div class="progress-container" id="progressContainer">
                        <h4>
                            <i class="fas fa-chart-line"></i> –ü—Ä–æ–≥—Ä–µ—Å—Å –∞–Ω–∞–ª–∏–∑–∞:
                        </h4>
                        <div class="progress-bar">
                            <div
                                class="progress-fill"
                                id="progressFill"
                                style="width: 0%"
                            >
                                0%
                            </div>
                        </div>
                        <p id="progressText">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞...</p>
                    </div>

                    <!-- –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞–Ω–∏—è -->
                    <div class="job-status" id="jobStatus"></div>

                    <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ -->
                    <div
                        id="resultContainer"
                        style="text-align: center; display: none"
                    >
                        <a href="#" id="downloadLink" class="download-btn">
                            <i class="fas fa-download"></i> –°–∫–∞—á–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                        </a>
                        <p style="margin-top: 10px; color: #666">
                            <i class="fas fa-clock"></i> –§–∞–π–ª –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è
                            —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –≤ —Ç–µ—á–µ–Ω–∏–µ —á–∞—Å–∞
                        </p>
                    </div>

                    <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä -->
                    <div id="previewContainer" style="display: none">
                        <h4>
                            <i class="fas fa-eye"></i> –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö
                            (–ø–µ—Ä–≤—ã–µ 5 —Å—Ç—Ä–æ–∫):
                        </h4>
                        <div class="preview-table" id="previewTable"></div>
                    </div>
                </div>
            </div>

            <footer>
                <p>
                    –ü–∞–∫–µ—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–æ–≤ ‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç—ã: .xlsx,
                    .xls, .csv
                </p>
            </footer>
        </div>

        <script>
            let currentJobId = null;
            let checkInterval = null;

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞
            document
                .getElementById("fileInput")
                .addEventListener("change", function (e) {
                    console.log("üìÅ –í—ã–±—Ä–∞–Ω —Ñ–∞–π–ª —á–µ—Ä–µ–∑ input");
                    uploadFile(this.files[0]);
                });

            // Drag and drop
            const uploadArea = document.getElementById("uploadArea");

            uploadArea.addEventListener("dragover", (e) => {
                e.preventDefault();
                uploadArea.style.background = "#e8f0fe";
            });

            uploadArea.addEventListener("dragleave", (e) => {
                e.preventDefault();
                uploadArea.style.background = "#f8f9fa";
            });

            uploadArea.addEventListener("drop", (e) => {
                e.preventDefault();
                uploadArea.style.background = "#f8f9fa";
                const file = e.dataTransfer.files[0];
                if (file) {
                    console.log("üìÅ –§–∞–π–ª –ø–µ—Ä–µ—Ç–∞—â–µ–Ω:", file.name);
                    uploadFile(file);
                }
            });

            function uploadFile(file) {
                if (!file) {
                    console.error("‚ùå –ù–µ—Ç —Ñ–∞–π–ª–∞");
                    return;
                }

                console.log(
                    "üì§ –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª:",
                    file.name,
                    "—Ä–∞–∑–º–µ—Ä:",
                    file.size,
                );

                const formData = new FormData();
                formData.append("file", file);

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ
                document.getElementById("fileInfo").style.display = "block";
                document.getElementById("fileName").textContent = file.name;
                document.getElementById("fileDetails").textContent =
                    `–†–∞–∑–º–µ—Ä: ${(file.size / 1024).toFixed(2)} KB | –¢–∏–ø: ${file.type || "Excel"}`;

                // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏
                const uploadArea = document.getElementById("uploadArea");
                uploadArea.style.opacity = "0.5";
                uploadArea.style.pointerEvents = "none";

                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª
                console.log("üîÑ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä...");

                fetch("/upload_excel", {
                    method: "POST",
                    body: formData,
                })
                    .then(async (response) => {
                        console.log(
                            "üì• –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞, —Å—Ç–∞—Ç—É—Å:",
                            response.status,
                        );
                        const data = await response.json();
                        console.log("üì¶ –î–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç–∞:", data);

                        if (!response.ok) {
                            throw new Error(
                                data.error ||
                                    `HTTP error! status: ${response.status}`,
                            );
                        }
                        return data;
                    })
                    .then((data) => {
                        console.log("‚úÖ –£—Å–ø–µ—à–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞:", data);
                        if (data.error) {
                            alert("–û—à–∏–±–∫–∞: " + data.error);
                            // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º
                            uploadArea.style.opacity = "1";
                            uploadArea.style.pointerEvents = "auto";
                        } else {
                            showColumnSelector(data);
                        }
                    })
                    .catch((error) => {
                        console.error("‚ùå –û—à–∏–±–∫–∞:", error);
                        alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞: " + error.message);
                        // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º
                        uploadArea.style.opacity = "1";
                        uploadArea.style.pointerEvents = "auto";
                    });
            }

            function showColumnSelector(data) {
                console.log("üìä –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–ª–µ–∫—Ç–æ—Ä –∫–æ–ª–æ–Ω–æ–∫");
                const selector = document.getElementById("columnSelector");
                const select = document.getElementById("columnSelect");

                select.innerHTML = "";

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–ø—Ü–∏–∏ —Å –±—É–∫–≤–∞–º–∏ –∫–æ–ª–æ–Ω–æ–∫
                data.columns.forEach((col) => {
                    const option = document.createElement("option");
                    option.value = col.letter;
                    option.textContent = col.display;

                    // –ï—Å–ª–∏ —ç—Ç–æ –∫–æ–ª–æ–Ω–∫–∞ D (–∏–Ω–¥–µ–∫—Å 3), –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –µ–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                    if (col.letter === "D") {
                        option.selected = true;
                        console.log("‚úÖ –ö–æ–ª–æ–Ω–∫–∞ D –≤—ã–±—Ä–∞–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é");
                    }

                    select.appendChild(option);
                });

                selector.style.display = "block";

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
                const previewContainer =
                    document.getElementById("previewContainer");
                const previewTable = document.getElementById("previewTable");

                let html = "<table><tr>";
                data.preview.columns.forEach((col) => {
                    html += `<th>${col}</th>`;
                });
                html += "</tr>";

                data.preview.rows.forEach((row) => {
                    html += "<tr>";
                    row.forEach((cell) => {
                        html += `<td>${cell || ""}</td>`;
                    });
                    html += "</tr>";
                });
                html += "</table>";

                previewTable.innerHTML = html;
                previewContainer.style.display = "block";

                // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º upload area
                document.getElementById("uploadArea").style.opacity = "1";
                document.getElementById("uploadArea").style.pointerEvents =
                    "auto";

                console.log("‚úÖ –°–µ–ª–µ–∫—Ç–æ—Ä –æ—Ç–æ–±—Ä–∞–∂–µ–Ω");
            }

            function startAnalysis() {
                const columnLetter =
                    document.getElementById("columnSelect").value;
                const includeConfidence =
                    document.getElementById("includeConfidence").checked;
                const includeAltTopics =
                    document.getElementById("includeAltTopics").checked;
                const addEmoji = document.getElementById("addEmoji").checked;

                console.log("‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞ –¥–ª—è –∫–æ–ª–æ–Ω–∫–∏:", columnLetter);

                if (!columnLetter) {
                    alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–æ–Ω–∫—É —Å —Ç–µ–∫—Å—Ç–∞–º–∏");
                    return;
                }

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
                document.getElementById("progressContainer").style.display =
                    "block";
                document.getElementById("columnSelector").style.display =
                    "none";

                fetch("/start_batch_analysis", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        column: columnLetter,
                        options: {
                            include_confidence: includeConfidence,
                            include_alt_topics: includeAltTopics,
                            add_emoji: addEmoji,
                        },
                    }),
                })
                    .then((response) => response.json())
                    .then((data) => {
                        console.log("üì• –û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:", data);
                        if (data.error) {
                            alert("–û—à–∏–±–∫–∞: " + data.error);
                        } else {
                            currentJobId = data.job_id;
                            startProgressCheck();
                        }
                    })
                    .catch((error) => {
                        console.error("‚ùå –û—à–∏–±–∫–∞:", error);
                        alert("–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∞–Ω–∞–ª–∏–∑–∞: " + error.message);
                    });
            }

            function startProgressCheck() {
                if (checkInterval) {
                    clearInterval(checkInterval);
                }
                checkInterval = setInterval(checkProgress, 1000);
            }

            function checkProgress() {
                if (!currentJobId) return;

                fetch(`/job_status/${currentJobId}`)
                    .then((response) => response.json())
                    .then((data) => {
                        updateProgress(data);

                        if (data.status === "completed") {
                            clearInterval(checkInterval);
                            showDownloadLink(data.result_filename);
                        } else if (data.status === "error") {
                            clearInterval(checkInterval);
                            showError(data.error);
                        }
                    })
                    .catch((error) => {
                        console.error("Error:", error);
                    });
            }

            function updateProgress(data) {
                const progressFill = document.getElementById("progressFill");
                const progressText = document.getElementById("progressText");

                const percent =
                    Math.round((data.progress / data.total) * 100) || 0;
                progressFill.style.width = percent + "%";
                progressFill.textContent = percent + "%";

                progressText.textContent = `–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ ${data.progress} –∏–∑ ${data.total} —Ç–µ–∫—Å—Ç–æ–≤`;

                const jobStatus = document.getElementById("jobStatus");
                jobStatus.style.display = "block";
                jobStatus.className = "job-status status-processing";
                jobStatus.innerHTML = `<i class="fas fa-spinner fa-spin"></i> –ê–Ω–∞–ª–∏–∑ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ...`;
            }

            function showDownloadLink(filename) {
                const jobStatus = document.getElementById("jobStatus");
                jobStatus.className = "job-status status-completed";
                jobStatus.innerHTML = `<i class="fas fa-check-circle"></i> –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω!`;

                document.getElementById("resultContainer").style.display =
                    "block";
                document.getElementById("downloadLink").href =
                    `/download/${filename}`;
            }

            function showError(error) {
                const jobStatus = document.getElementById("jobStatus");
                jobStatus.style.display = "block";
                jobStatus.className = "job-status status-error";
                jobStatus.innerHTML = `<i class="fas fa-exclamation-circle"></i> –û—à–∏–±–∫–∞: ${error}`;
            }
        </script>
    </body>
</html>
